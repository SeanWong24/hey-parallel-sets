import{r as n,h as t,H as i,g as r}from"./p-63d54ee1.js";var u={Identity:function(n){return n},True:function(){return!0},Blank:function(){}},e={"":u.Identity},o=function(n){if(null==n)return u.Identity;if("string"==typeof n){let t=e[n];if(null!=t)return t;if(-1===n.indexOf("=>")){const i=new RegExp("[$]+","g");let r,u=0;for(;null!=(r=i.exec(n));)r[0].length>u&&(u=r[0].length);const o=[];for(let n=1;n<=u;n++){let t="";for(let i=0;i<n;i++)t+="$";o.push(t)}const s=o.join(",");return t=new Function(s,"return "+n),e[n]=t,t}{const i=n.match(/^[(\s]*([^()]*?)[)\s]*=>(.*)/);return t=new Function(i[1],i[2].match(/\breturn\b/)?i[2]:"return "+i[2]),e[n]=t,t}}return n},s=function(n,t,i){Object.defineProperty(n,t,{enumerable:!1,configurable:!0,writable:!0,value:i})},f=function(n,t){return n===t?0:n>t?1:-1},c=function(n){null!=n&&n.dispose()},l=function(n,t,i){var r=new h,u=0;this.current=r.current,this.moveNext=function(){try{switch(u){case 0:u=1,n();case 1:return!!t.apply(r)||(this.dispose(),!1);case 2:return!1}}catch(n){throw this.dispose(),n}},this.dispose=function(){if(1==u)try{i()}finally{u=2}}},h=function(){var n=null;this.current=function(){return n},this.yieldReturn=function(t){return n=t,!0},this.yieldBreak=function(){return!1}},a=function(n){this.getEnumerator=n};(a.Utils={}).createLambda=function(n){return o(n)},a.Utils.createEnumerable=function(n){return new a(n)},a.Utils.createEnumerator=function(n,t,i){return new l(n,t,i)},a.Utils.extendTo=function(n){var t,i=n.prototype;n===Array?(t=g.prototype,s(i,"getSource",(function(){return this}))):(t=a.prototype,s(i,"getEnumerator",(function(){return a.from(this).getEnumerator()})));for(let n in t){const r=t[n];i[n]!=r&&(null!=i[n]&&(n+="ByLinq",i[n]==r)||r instanceof Function&&s(i,n,r))}},a.Utils.recallFrom=function(n){var t,i=n.prototype;n===Array?(t=g.prototype,delete i.getSource):(t=a.prototype,delete i.getEnumerator);for(const n in t){const r=t[n];i[n+"ByLinq"]?delete i[n+"ByLinq"]:i[n]==r&&r instanceof Function&&delete i[n]}},a.choice=function(){var n=arguments;return new a((function(){return new l((function(){n=n[0]instanceof Array?n[0]:null!=n[0].getEnumerator?n[0].toArray():n}),(function(){return this.yieldReturn(n[Math.floor(Math.random()*n.length)])}),u.Blank)}))},a.cycle=function(){var n=arguments;return new a((function(){var t=0;return new l((function(){n=n[0]instanceof Array?n[0]:null!=n[0].getEnumerator?n[0].toArray():n}),(function(){return t>=n.length&&(t=0),this.yieldReturn(n[t++])}),u.Blank)}))},a.empty=function(){return new a((function(){return new l(u.Blank,(function(){return!1}),u.Blank)}))},a.from=function(n){if(null==n)return a.empty();if(n instanceof a)return n;if("number"==typeof n||"boolean"==typeof n)return a.repeat(n,1);if("string"==typeof n)return new a((function(){var t=0;return new l(u.Blank,(function(){return t<n.length&&this.yieldReturn(n.charAt(t++))}),u.Blank)}));if("function"!=typeof n){if("number"==typeof n.length)return new g(n);if("undefined"!=typeof Symbol&&void 0!==n[Symbol.iterator])return new a((function(){return new l(u.Blank,(function(){var t=n.next();return!t.done&&this.yieldReturn(t.value)}),u.Blank)}))}return new a((function(){var t=[],i=0;return new l((function(){for(const i in n){const r=n[i];r instanceof Function||!Object.prototype.hasOwnProperty.call(n,i)||t.push({key:i,value:r})}}),(function(){return i<t.length&&this.yieldReturn(t[i++])}),u.Blank)}))},a.make=function(n){return a.repeat(n,1)},a.matches=function(n,t,i){return null==i&&(i=""),t instanceof RegExp&&(i+=t.ignoreCase?"i":"",i+=t.multiline?"m":"",t=t.source),-1===i.indexOf("g")&&(i+="g"),new a((function(){var r;return new l((function(){r=new RegExp(t,i)}),(function(){var t=r.exec(n);return!!t&&this.yieldReturn(t)}),u.Blank)}))},a.range=function(n,t,i){return null==i&&(i=1),new a((function(){var r,e=0;return new l((function(){r=n-i}),(function(){return e++<t?this.yieldReturn(r+=i):this.yieldBreak()}),u.Blank)}))},a.rangeDown=function(n,t,i){return null==i&&(i=1),new a((function(){var r,e=0;return new l((function(){r=n+i}),(function(){return e++<t?this.yieldReturn(r-=i):this.yieldBreak()}),u.Blank)}))},a.rangeTo=function(n,t,i){return null==i&&(i=1),new a(n<t?function(){var r;return new l((function(){r=n-i}),(function(){var n=r+=i;return n<=t?this.yieldReturn(n):this.yieldBreak()}),u.Blank)}:function(){var r;return new l((function(){r=n+i}),(function(){var n=r-=i;return n>=t?this.yieldReturn(n):this.yieldBreak()}),u.Blank)})},a.repeat=function(n,t){return null!=t?a.repeat(n).take(t):new a((function(){return new l(u.Blank,(function(){return this.yieldReturn(n)}),u.Blank)}))},a.repeatWithFinalize=function(n,t){return n=o(n),t=o(t),new a((function(){var i;return new l((function(){i=n()}),(function(){return this.yieldReturn(i)}),(function(){null!=i&&(t(i),i=null)}))}))},a.generate=function(n,t){return null!=t?a.generate(n).take(t):(n=o(n),new a((function(){return new l(u.Blank,(function(){return this.yieldReturn(n())}),u.Blank)})))},a.toInfinity=function(n,t){return null==n&&(n=0),null==t&&(t=1),new a((function(){var i;return new l((function(){i=n-t}),(function(){return this.yieldReturn(i+=t)}),u.Blank)}))},a.toNegativeInfinity=function(n,t){return null==n&&(n=0),null==t&&(t=1),new a((function(){var i;return new l((function(){i=n+t}),(function(){return this.yieldReturn(i-=t)}),u.Blank)}))},a.unfold=function(n,t){return t=o(t),new a((function(){var i,r=!0;return new l(u.Blank,(function(){return r?(r=!1,this.yieldReturn(i=n)):(i=t(i),this.yieldReturn(i))}),u.Blank)}))},a.defer=function(n){return new a((function(){var t;return new l((function(){t=a.from(n()).getEnumerator()}),(function(){return t.moveNext()?this.yieldReturn(t.current()):this.yieldBreak()}),(function(){c(t)}))}))},a.prototype.traverseBreadthFirst=function(n,t){var i=this;return n=o(n),t=o(t),new a((function(){var r,u=0,e=[];return new l((function(){r=i.getEnumerator()}),(function(){for(;;){if(r.moveNext())return e.push(r.current()),this.yieldReturn(t(r.current(),u));const i=a.from(e).selectMany((function(t){return n(t)}));if(!i.any())return!1;u++,e=[],c(r),r=i.getEnumerator()}}),(function(){c(r)}))}))},a.prototype.traverseDepthFirst=function(n,t){var i=this;return n=o(n),t=o(t),new a((function(){var r,u=[];return new l((function(){r=i.getEnumerator()}),(function(){for(;;){if(r.moveNext()){const i=t(r.current(),u.length);return u.push(r),r=a.from(n(r.current())).getEnumerator(),this.yieldReturn(i)}if(u.length<=0)return!1;c(r),r=u.pop()}}),(function(){try{c(r)}finally{a.from(u).forEach((function(n){n.dispose()}))}}))}))},a.prototype.flatten=function(){var n=this;return new a((function(){var t,i=null;return new l((function(){t=n.getEnumerator()}),(function(){for(;;){if(null!=i){if(i.moveNext())return this.yieldReturn(i.current());i=null}if(t.moveNext()){if(t.current()instanceof Array){c(i),i=a.from(t.current()).selectMany(u.Identity).flatten().getEnumerator();continue}return this.yieldReturn(t.current())}return!1}}),(function(){try{c(t)}finally{c(i)}}))}))},a.prototype.pairwise=function(n){var t=this;return n=o(n),new a((function(){var i;return new l((function(){(i=t.getEnumerator()).moveNext()}),(function(){var t=i.current();return!!i.moveNext()&&this.yieldReturn(n(t,i.current()))}),(function(){c(i)}))}))},a.prototype.scan=function(n,t){var i;null==t?(t=o(n),i=!1):(t=o(t),i=!0);var r=this;return new a((function(){var u,e,o=!0;return new l((function(){u=r.getEnumerator()}),(function(){if(o){if(o=!1,i)return this.yieldReturn(e=n);if(u.moveNext())return this.yieldReturn(e=u.current())}return!!u.moveNext()&&this.yieldReturn(e=t(e,u.current()))}),(function(){c(u)}))}))},a.prototype.select=function(n){if((n=o(n)).length<=1)return new m(this,null,n);var t=this;return new a((function(){var i,r=0;return new l((function(){i=t.getEnumerator()}),(function(){return!!i.moveNext()&&this.yieldReturn(n(i.current(),r++))}),(function(){c(i)}))}))},a.prototype.selectMany=function(n,t){var i=this;return n=o(n),null==t&&(t=function(n,t){return t}),t=o(t),new a((function(){var r,u=void 0,e=0;return new l((function(){r=i.getEnumerator()}),(function(){if(void 0===u&&!r.moveNext())return!1;do{if(null==u){const t=n(r.current(),e++);u=a.from(t).getEnumerator()}if(u.moveNext())return this.yieldReturn(t(r.current(),u.current()));c(u),u=null}while(r.moveNext());return!1}),(function(){try{c(r)}finally{c(u)}}))}))},a.prototype.where=function(n){if((n=o(n)).length<=1)return new y(this,n);var t=this;return new a((function(){var i,r=0;return new l((function(){i=t.getEnumerator()}),(function(){for(;i.moveNext();)if(n(i.current(),r++))return this.yieldReturn(i.current());return!1}),(function(){c(i)}))}))},a.prototype.choose=function(n){n=o(n);var t=this;return new a((function(){var i,r=0;return new l((function(){i=t.getEnumerator()}),(function(){for(;i.moveNext();){const t=n(i.current(),r++);if(null!=t)return this.yieldReturn(t)}return this.yieldBreak()}),(function(){c(i)}))}))},a.prototype.ofType=function(n){var t;switch(n){case Number:t="number";break;case String:t="string";break;case Boolean:t="boolean";break;case Function:t="function";break;default:t=null}return this.where(null===t?function(t){return t instanceof n}:function(n){return typeof n===t})},a.prototype.zip=function(){var n=arguments,t=o(arguments[arguments.length-1]),i=this;if(2==arguments.length){const n=arguments[0];return new a((function(){var r,u,e=0;return new l((function(){r=i.getEnumerator(),u=a.from(n).getEnumerator()}),(function(){return!(!r.moveNext()||!u.moveNext())&&this.yieldReturn(t(r.current(),u.current(),e++))}),(function(){try{c(r)}finally{c(u)}}))}))}return new a((function(){var r,u=0;return new l((function(){var t=a.make(i).concat(a.from(n).takeExceptLast().select(a.from)).select((function(n){return n.getEnumerator()})).toArray();r=a.from(t)}),(function(){if(r.all((function(n){return n.moveNext()}))){const n=r.select((function(n){return n.current()})).toArray();return n.push(u++),this.yieldReturn(t.apply(null,n))}return this.yieldBreak()}),(function(){a.from(r).forEach(c)}))}))},a.prototype.merge=function(){var n=arguments,t=this;return new a((function(){var i,r=-1;return new l((function(){i=a.make(t).concat(a.from(n).select(a.from)).select((function(n){return n.getEnumerator()})).toArray()}),(function(){for(;i.length>0;){const n=i[r=r>=i.length-1?0:r+1];if(n.moveNext())return this.yieldReturn(n.current());n.dispose(),i.splice(r--,1)}return this.yieldBreak()}),(function(){a.from(i).forEach(c)}))}))},a.prototype.join=function(n,t,i,r,e){t=o(t),i=o(i),r=o(r),e=o(e);var s=this;return new a((function(){var o,f,h=null,v=0;return new l((function(){o=s.getEnumerator(),f=a.from(n).toLookup(i,u.Identity,e)}),(function(){for(;;){if(null!=h){let n=h[v++];if(void 0!==n)return this.yieldReturn(r(o.current(),n));n=null,v=0}if(!o.moveNext())return!1;{const n=t(o.current());h=f.get(n).toArray()}}}),(function(){c(o)}))}))},a.prototype.leftJoin=function(n,t,i,r,e){t=o(t),i=o(i),r=o(r),e=o(e);var s=this;return new a((function(){var o,f,h=null,v=0;return new l((function(){o=s.getEnumerator(),f=a.from(n).toLookup(i,u.Identity,e)}),(function(){for(;;){if(null!=h){let n=h[v++];if(void 0!==n)return this.yieldReturn(r(o.current(),n));n=null,v=0}if(!o.moveNext())return!1;{const n=t(o.current());if(null==(h=f.get(n).toArray())||0==h.length)return this.yieldReturn(r(o.current(),null))}}}),(function(){c(o)}))}))},a.prototype.groupJoin=function(n,t,i,r,e){t=o(t),i=o(i),r=o(r),e=o(e);var s=this;return new a((function(){var o=s.getEnumerator(),f=null;return new l((function(){o=s.getEnumerator(),f=a.from(n).toLookup(i,u.Identity,e)}),(function(){if(o.moveNext()){const n=f.get(t(o.current()));return this.yieldReturn(r(o.current(),n))}return!1}),(function(){c(o)}))}))},a.prototype.all=function(n){n=o(n);var t=!0;return this.forEach((function(i){if(!n(i))return t=!1,!1})),t},a.prototype.any=function(n){n=o(n);var t=this.getEnumerator();try{if(0==arguments.length)return t.moveNext();for(;t.moveNext();)if(n(t.current()))return!0;return!1}finally{c(t)}},a.prototype.isEmpty=function(){return!this.any()},a.prototype.concat=function(){var n=this;if(1==arguments.length){const t=arguments[0];return new a((function(){var i,r;return new l((function(){i=n.getEnumerator()}),(function(){if(null==r){if(i.moveNext())return this.yieldReturn(i.current());r=a.from(t).getEnumerator()}return!!r.moveNext()&&this.yieldReturn(r.current())}),(function(){try{c(i)}finally{c(r)}}))}))}{const t=arguments;return new a((function(){var i;return new l((function(){i=a.make(n).concat(a.from(t).select(a.from)).select((function(n){return n.getEnumerator()})).toArray()}),(function(){for(;i.length>0;){const n=i[0];if(n.moveNext())return this.yieldReturn(n.current());n.dispose(),i.splice(0,1)}return this.yieldBreak()}),(function(){a.from(i).forEach(c)}))}))}},a.prototype.insert=function(n,t){var i=this;return new a((function(){var r,u,e=0,o=!1;return new l((function(){r=i.getEnumerator(),u=a.from(t).getEnumerator()}),(function(){return e==n&&u.moveNext()?(o=!0,this.yieldReturn(u.current())):r.moveNext()?(e++,this.yieldReturn(r.current())):!(o||!u.moveNext())&&this.yieldReturn(u.current())}),(function(){try{c(r)}finally{c(u)}}))}))},a.prototype.alternate=function(n){var t=this;return new a((function(){var i,r,u,e;return new l((function(){u=n instanceof Array||null!=n.getEnumerator?a.from(a.from(n).toArray()):a.make(n),(r=t.getEnumerator()).moveNext()&&(i=r.current())}),(function(){for(;;){if(null!=e){if(e.moveNext())return this.yieldReturn(e.current());e=null}if(null!=i||!r.moveNext()){if(null!=i){const n=i;return i=null,this.yieldReturn(n)}return this.yieldBreak()}i=r.current(),e=u.getEnumerator()}}),(function(){try{c(r)}finally{c(e)}}))}))},a.prototype.contains=function(n,t){t=o(t);var i=this.getEnumerator();try{for(;i.moveNext();)if(t(i.current())===n)return!0;return!1}finally{c(i)}},a.prototype.defaultIfEmpty=function(n){var t=this;return void 0===n&&(n=null),new a((function(){var i,r=!0;return new l((function(){i=t.getEnumerator()}),(function(){return i.moveNext()?(r=!1,this.yieldReturn(i.current())):!!r&&(r=!1,this.yieldReturn(n))}),(function(){c(i)}))}))},a.prototype.distinct=function(n){return this.except(a.empty(),n)},a.prototype.distinctUntilChanged=function(n){n=o(n);var t=this;return new a((function(){var i,r;return new l((function(){i=t.getEnumerator()}),(function(){for(;i.moveNext();){const t=n(i.current());if(r!==t)return r=t,this.yieldReturn(i.current())}return this.yieldBreak()}),(function(){c(i)}))}))},a.prototype.except=function(n,t){t=o(t);var i=this;return new a((function(){var r,u;return new l((function(){r=i.getEnumerator(),u=new b(t),a.from(n).forEach((function(n){u.add(n)}))}),(function(){for(;r.moveNext();){const n=r.current();if(!u.contains(n))return u.add(n),this.yieldReturn(n)}return!1}),(function(){c(r)}))}))},a.prototype.intersect=function(n,t){t=o(t);var i=this;return new a((function(){var r,u,e;return new l((function(){r=i.getEnumerator(),u=new b(t),a.from(n).forEach((function(n){u.add(n)})),e=new b(t)}),(function(){for(;r.moveNext();){const n=r.current();if(!e.contains(n)&&u.contains(n))return e.add(n),this.yieldReturn(n)}return!1}),(function(){c(r)}))}))},a.prototype.sequenceEqual=function(n,t){t=o(t);var i=this.getEnumerator();try{const r=a.from(n).getEnumerator();try{for(;i.moveNext();)if(!r.moveNext()||t(i.current())!==t(r.current()))return!1;return!r.moveNext()}finally{c(r)}}finally{c(i)}},a.prototype.union=function(n,t){t=o(t);var i=this;return new a((function(){var r,u,e;return new l((function(){r=i.getEnumerator(),e=new b(t)}),(function(){var t;if(void 0===u){for(;r.moveNext();)if(t=r.current(),!e.contains(t))return e.add(t),this.yieldReturn(t);u=a.from(n).getEnumerator()}for(;u.moveNext();)if(t=u.current(),!e.contains(t))return e.add(t),this.yieldReturn(t);return!1}),(function(){try{c(r)}finally{c(u)}}))}))},a.prototype.orderBy=function(n,t){return new v(this,n,t,!1)},a.prototype.orderByDescending=function(n,t){return new v(this,n,t,!0)},a.prototype.reverse=function(){var n=this;return new a((function(){var t,i;return new l((function(){t=n.toArray(),i=t.length}),(function(){return i>0&&this.yieldReturn(t[--i])}),u.Blank)}))},a.prototype.shuffle=function(){var n=this;return new a((function(){var t;return new l((function(){t=n.toArray()}),(function(){if(t.length>0){const n=Math.floor(Math.random()*t.length);return this.yieldReturn(t.splice(n,1)[0])}return!1}),u.Blank)}))},a.prototype.weightedSample=function(n){n=o(n);var t=this;return new a((function(){var i,r=0;return new l((function(){i=t.choose((function(t){var i=n(t);return i<=0?null:{value:t,bound:r+=i}})).toArray()}),(function(){if(i.length>0){const n=Math.floor(Math.random()*r)+1;let t=-1,u=i.length;for(;u-t>1;){const r=Math.floor((t+u)/2);i[r].bound>=n?u=r:t=r}return this.yieldReturn(i[u].value)}return this.yieldBreak()}),u.Blank)}))},a.prototype.groupBy=function(n,t,i,r){var u=this;return n=o(n),t=o(t),null!=i&&(i=o(i)),r=o(r),new a((function(){var e;return new l((function(){e=u.toLookup(n,t,r).toEnumerable().getEnumerator()}),(function(){for(;e.moveNext();)return this.yieldReturn(null==i?e.current():i(e.current().key(),e.current()));return!1}),(function(){c(e)}))}))},a.prototype.partitionBy=function(n,t,i,r){var u,e=this;return n=o(n),t=o(t),r=o(r),null==i?(u=!1,i=function(n,t){return new x(n,t)}):(u=!0,i=o(i)),new a((function(){var o,s,f,h=[];return new l((function(){(o=e.getEnumerator()).moveNext()&&(s=n(o.current()),f=r(s),h.push(t(o.current())))}),(function(){for(var e;1==(e=o.moveNext())&&f===r(n(o.current()));)h.push(t(o.current()));if(h.length>0){const c=i(s,u?a.from(h):h);return e?(s=n(o.current()),f=r(s),h=[t(o.current())]):h=[],this.yieldReturn(c)}return!1}),(function(){c(o)}))}))},a.prototype.buffer=function(n){var t=this;return new a((function(){var i;return new l((function(){i=t.getEnumerator()}),(function(){for(var t=[],r=0;i.moveNext();)if(t.push(i.current()),++r>=n)return this.yieldReturn(t);return t.length>0&&this.yieldReturn(t)}),(function(){c(i)}))}))},a.prototype.aggregate=function(n,t,i){return(i=o(i))(this.scan(n,t,i).last())},a.prototype.average=function(n){n=o(n);var t=0,i=0;return this.forEach((function(r){t+=n(r),++i})),t/i},a.prototype.count=function(n){n=null==n?u.True:o(n);var t=0;return this.forEach((function(i,r){n(i,r)&&++t})),t},a.prototype.max=function(n){return null==n&&(n=u.Identity),this.select(n).aggregate((function(n,t){return n>t?n:t}))},a.prototype.min=function(n){return null==n&&(n=u.Identity),this.select(n).aggregate((function(n,t){return n<t?n:t}))},a.prototype.maxBy=function(n){return n=o(n),this.aggregate((function(t,i){return n(t)>n(i)?t:i}))},a.prototype.minBy=function(n){return n=o(n),this.aggregate((function(t,i){return n(t)<n(i)?t:i}))},a.prototype.sum=function(n){return null==n&&(n=u.Identity),this.select(n).aggregate(0,(function(n,t){return n+t}))},a.prototype.elementAt=function(n){var t,i=!1;if(this.forEach((function(r,u){if(u==n)return t=r,i=!0,!1})),!i)throw new Error("index is less than 0 or greater than or equal to the number of elements in source.");return t},a.prototype.elementAtOrDefault=function(n,t){var i;void 0===t&&(t=null);var r=!1;return this.forEach((function(t,u){if(u==n)return i=t,r=!0,!1})),r?i:t},a.prototype.first=function(n){if(null!=n)return this.where(n).first();var t,i=!1;if(this.forEach((function(n){return t=n,i=!0,!1})),!i)throw new Error("first:No element satisfies the condition.");return t},a.prototype.firstOrDefault=function(n,t){if(void 0!==n){if("function"==typeof n||"function"==typeof o(n))return this.where(n).firstOrDefault(void 0,t);t=n}var i,r=!1;return this.forEach((function(n){return i=n,r=!0,!1})),r?i:t},a.prototype.last=function(n){if(null!=n)return this.where(n).last();var t,i=!1;if(this.forEach((function(n){i=!0,t=n})),!i)throw new Error("last:No element satisfies the condition.");return t},a.prototype.lastOrDefault=function(n,t){if(void 0!==n){if("function"==typeof n||"function"==typeof o(n))return this.where(n).lastOrDefault(void 0,t);t=n}var i,r=!1;return this.forEach((function(n){r=!0,i=n})),r?i:t},a.prototype.single=function(n){if(null!=n)return this.where(n).single();var t,i=!1;if(this.forEach((function(n){if(i)throw new Error("single:sequence contains more than one element.");i=!0,t=n})),!i)throw new Error("single:No element satisfies the condition.");return t},a.prototype.singleOrDefault=function(n,t){if(void 0===t&&(t=null),null!=n)return this.where(n).singleOrDefault(null,t);var i,r=!1;return this.forEach((function(n){if(r)throw new Error("single:sequence contains more than one element.");r=!0,i=n})),r?i:t},a.prototype.skip=function(n){var t=this;return new a((function(){var i,r=0;return new l((function(){for(i=t.getEnumerator();r++<n&&i.moveNext(););}),(function(){return!!i.moveNext()&&this.yieldReturn(i.current())}),(function(){c(i)}))}))},a.prototype.skipWhile=function(n){n=o(n);var t=this;return new a((function(){var i,r=0,u=!1;return new l((function(){i=t.getEnumerator()}),(function(){for(;!u;){if(!i.moveNext())return!1;if(!n(i.current(),r++))return u=!0,this.yieldReturn(i.current())}return!!i.moveNext()&&this.yieldReturn(i.current())}),(function(){c(i)}))}))},a.prototype.take=function(n){var t=this;return new a((function(){var i,r=0;return new l((function(){i=t.getEnumerator()}),(function(){return!!(r++<n&&i.moveNext())&&this.yieldReturn(i.current())}),(function(){c(i)}))}))},a.prototype.takeWhile=function(n){n=o(n);var t=this;return new a((function(){var i,r=0;return new l((function(){i=t.getEnumerator()}),(function(){return!(!i.moveNext()||!n(i.current(),r++))&&this.yieldReturn(i.current())}),(function(){c(i)}))}))},a.prototype.takeExceptLast=function(n){null==n&&(n=1);var t=this;return new a((function(){if(n<=0)return t.getEnumerator();var i,r=[];return new l((function(){i=t.getEnumerator()}),(function(){for(;i.moveNext();){if(r.length==n)return r.push(i.current()),this.yieldReturn(r.shift());r.push(i.current())}return!1}),(function(){c(i)}))}))},a.prototype.takeFromLast=function(n){if(n<=0||null==n)return a.empty();var t=this;return new a((function(){var i,r,u=[];return new l((function(){i=t.getEnumerator()}),(function(){for(;i.moveNext();)u.length==n&&u.shift(),u.push(i.current());return null==r&&(r=a.from(u).getEnumerator()),!!r.moveNext()&&this.yieldReturn(r.current())}),(function(){c(r)}))}))},a.prototype.indexOf=function(n){var t=null;return this.forEach("function"==typeof n?function(i,r){if(n(i,r))return t=r,!1}:function(i,r){if(i===n)return t=r,!1}),null!==t?t:-1},a.prototype.lastIndexOf=function(n){var t=-1;return this.forEach("function"==typeof n?function(i,r){n(i,r)&&(t=r)}:function(i,r){i===n&&(t=r)}),t},a.prototype.cast=function(){return this},a.prototype.asEnumerable=function(){return a.from(this)},a.prototype.toArray=function(){var n=[];return this.forEach((function(t){n.push(t)})),n},a.prototype.toLookup=function(n,t,i){n=o(n),t=o(t),i=o(i);var r=new b(i);return this.forEach((function(i){var u=n(i),e=t(i),o=r.get(u);void 0!==o?o.push(e):r.add(u,[e])})),new p(r)},a.prototype.toObject=function(n,t){n=o(n),t=o(t);var i={};return this.forEach((function(r){i[n(r)]=t(r)})),i},a.prototype.toDictionary=function(n,t,i){n=o(n),t=o(t),i=o(i);var r=new b(i);return this.forEach((function(i){r.add(n(i),t(i))})),r},a.prototype.toJSONString=function(n,t){if("undefined"==typeof JSON||null==JSON.stringify)throw new Error("toJSONString can't find JSON.stringify. This works native JSON support Browser or include json2.js");return JSON.stringify(this.toArray(),n,t)},a.prototype.toJoinedString=function(n,t){return null==n&&(n=""),null==t&&(t=u.Identity),this.select(t).toArray().join(n)},a.prototype.doAction=function(n){var t=this;return n=o(n),new a((function(){var i,r=0;return new l((function(){i=t.getEnumerator()}),(function(){return!!i.moveNext()&&(n(i.current(),r++),this.yieldReturn(i.current()))}),(function(){c(i)}))}))},a.prototype.forEach=function(n){n=o(n);var t=0,i=this.getEnumerator();try{for(;i.moveNext()&&!1!==n(i.current(),t++););}finally{c(i)}},a.prototype.force=function(){var n=this.getEnumerator();try{for(;n.moveNext(););}finally{c(n)}},a.prototype.letBind=function(n){n=o(n);var t=this;return new a((function(){var i;return new l((function(){i=a.from(n(t)).getEnumerator()}),(function(){return!!i.moveNext()&&this.yieldReturn(i.current())}),(function(){c(i)}))}))},a.prototype.share=function(){var n,t=this,i=!1;return new w((function(){return new l((function(){null==n&&(n=t.getEnumerator())}),(function(){if(i)throw new Error("enumerator is disposed");return!!n.moveNext()&&this.yieldReturn(n.current())}),u.Blank)}),(function(){i=!0,c(n)}))},a.prototype.memoize=function(){var n,t,i=this,r=!1;return new w((function(){var e=-1;return new l((function(){null==t&&(t=i.getEnumerator(),n=[])}),(function(){if(r)throw new Error("enumerator is disposed");return e++,n.length<=e?!!t.moveNext()&&this.yieldReturn(n[e]=t.current()):this.yieldReturn(n[e])}),u.Blank)}),(function(){r=!0,c(t),n=null}))},"undefined"!=typeof Symbol&&void 0!==Symbol.iterator&&(a.prototype[Symbol.iterator]=function(){return{enumerator:this.getEnumerator(),next:function(){return this.enumerator.moveNext()?{done:!1,value:this.enumerator.current()}:{done:!0}}}}),a.prototype.catchError=function(n){n=o(n);var t=this;return new a((function(){var i;return new l((function(){i=t.getEnumerator()}),(function(){try{return!!i.moveNext()&&this.yieldReturn(i.current())}catch(t){return n(t),!1}}),(function(){c(i)}))}))},a.prototype.finallyAction=function(n){n=o(n);var t=this;return new a((function(){var i;return new l((function(){i=t.getEnumerator()}),(function(){return!!i.moveNext()&&this.yieldReturn(i.current())}),(function(){try{c(i)}finally{n()}}))}))},a.prototype.log=function(n){return n=o(n),this.doAction((function(t){"undefined"!=typeof console&&console.log(n(t))}))},a.prototype.trace=function(n,t){return null==n&&(n="Trace"),t=o(t),this.doAction((function(i){"undefined"!=typeof console&&console.log(n,t(i))}))};var v=function(n,t,i,r,u){this.source=n,this.keySelector=o(t),this.descending=r,this.parent=u,i&&(this.comparer=o(i))};v.prototype=new a,v.prototype.createOrderedEnumerable=function(n,t,i){return new v(this.source,n,t,i,this)},v.prototype.thenBy=function(n,t){return this.createOrderedEnumerable(n,t,!1)},v.prototype.thenByDescending=function(n,t){return this.createOrderedEnumerable(n,t,!0)},v.prototype.getEnumerator=function(){var n,t,i=this,r=0;return new l((function(){n=[],t=[],i.source.forEach((function(i,r){n.push(i),t.push(r)}));var r=d.create(i,null);r.GenerateKeys(n),t.sort((function(n,t){return r.compare(n,t)}))}),(function(){return r<t.length&&this.yieldReturn(n[t[r++]])}),u.Blank)};var d=function(n,t,i,r){this.keySelector=n,this.descending=i,this.child=r,this.comparer=t,this.keys=null};d.create=function(n,t){var i=new d(n.keySelector,n.comparer,n.descending,t);return null!=n.parent?d.create(n.parent,i):i},d.prototype.GenerateKeys=function(n){var t=n.length,i=this.keySelector,r=new Array(t);for(let u=0;u<t;u++)r[u]=i(n[u]);this.keys=r,null!=this.child&&this.child.GenerateKeys(n)},d.prototype.compare=function(n,t){var i=this.comparer?this.comparer(this.keys[n],this.keys[t]):f(this.keys[n],this.keys[t]);return 0==i?null!=this.child?this.child.compare(n,t):f(n,t):this.descending?-i:i};var w=function(n,t){this.dispose=t,a.call(this,n)};w.prototype=new a;var g=function(n){this.getSource=function(){return n}};g.prototype=new a,g.prototype.any=function(n){return null==n?this.getSource().length>0:a.prototype.any.apply(this,arguments)},g.prototype.count=function(n){return null==n?this.getSource().length:a.prototype.count.apply(this,arguments)},g.prototype.elementAt=function(n){var t=this.getSource();return 0<=n&&n<t.length?t[n]:a.prototype.elementAt.apply(this,arguments)},g.prototype.elementAtOrDefault=function(n,t){void 0===t&&(t=null);var i=this.getSource();return 0<=n&&n<i.length?i[n]:t},g.prototype.first=function(n){var t=this.getSource();return null==n&&t.length>0?t[0]:a.prototype.first.apply(this,arguments)},g.prototype.firstOrDefault=function(n,t){if(void 0!==n)return a.prototype.firstOrDefault.apply(this,arguments);t=n;var i=this.getSource();return i.length>0?i[0]:t},g.prototype.last=function(n){var t=this.getSource();return null==n&&t.length>0?t[t.length-1]:a.prototype.last.apply(this,arguments)},g.prototype.lastOrDefault=function(n,t){if(void 0!==n)return a.prototype.lastOrDefault.apply(this,arguments);t=n;var i=this.getSource();return i.length>0?i[i.length-1]:t},g.prototype.skip=function(n){var t=this.getSource();return new a((function(){var i;return new l((function(){i=n<0?0:n}),(function(){return i<t.length&&this.yieldReturn(t[i++])}),u.Blank)}))},g.prototype.takeExceptLast=function(n){return null==n&&(n=1),this.take(this.getSource().length-n)},g.prototype.takeFromLast=function(n){return this.skip(this.getSource().length-n)},g.prototype.reverse=function(){var n=this.getSource();return new a((function(){var t;return new l((function(){t=n.length}),(function(){return t>0&&this.yieldReturn(n[--t])}),u.Blank)}))},g.prototype.sequenceEqual=function(n,t){return(!(n instanceof g||n instanceof Array)||null!=t||a.from(n).count()==this.count())&&a.prototype.sequenceEqual.apply(this,arguments)},g.prototype.toJoinedString=function(n,t){var i=this.getSource();return null==t&&i instanceof Array?(null==n&&(n=""),i.join(n)):a.prototype.toJoinedString.apply(this,arguments)},g.prototype.getEnumerator=function(){var n=this.getSource(),t=-1;return{current:function(){return n[t]},moveNext:function(){return++t<n.length},dispose:u.Blank}};var y=function(n,t){this.prevSource=n,this.prevPredicate=t};y.prototype=new a,y.prototype.where=function(n){if((n=o(n)).length<=1){const t=this.prevPredicate;return new y(this.prevSource,(function(i){return t(i)&&n(i)}))}return a.prototype.where.call(this,n)},y.prototype.select=function(n){return(n=o(n)).length<=1?new m(this.prevSource,this.prevPredicate,n):a.prototype.select.call(this,n)},y.prototype.getEnumerator=function(){var n,t=this.prevPredicate,i=this.prevSource;return new l((function(){n=i.getEnumerator()}),(function(){for(;n.moveNext();)if(t(n.current()))return this.yieldReturn(n.current());return!1}),(function(){c(n)}))};var m=function(n,t,i){this.prevSource=n,this.prevPredicate=t,this.prevSelector=i};m.prototype=new a,m.prototype.where=function(n){return(n=o(n)).length<=1?new y(this,n):a.prototype.where.call(this,n)},m.prototype.select=function(n){if((n=o(n)).length<=1){const t=this.prevSelector;return new m(this.prevSource,this.prevPredicate,(function(i){return n(t(i))}))}return a.prototype.select.call(this,n)},m.prototype.getEnumerator=function(){var n,t=this.prevPredicate,i=this.prevSelector,r=this.prevSource;return new l((function(){n=r.getEnumerator()}),(function(){for(;n.moveNext();)if(null==t||t(n.current()))return this.yieldReturn(i(n.current()));return!1}),(function(){c(n)}))};var b=function(){var n=function(n,t){return Object.prototype.hasOwnProperty.call(n,t)},t=function(n){return null===n?"null":void 0===n?"undefined":"function"==typeof n.toString?n.toString():Object.prototype.toString.call(n)},i=function(n,t){this.key=n,this.value=t,this.prev=null,this.next=null},r=function(){this.first=null,this.last=null};r.prototype={addLast:function(n){null!=this.last?(this.last.next=n,n.prev=this.last,this.last=n):this.first=this.last=n},replace:function(n,t){null!=n.prev?(n.prev.next=t,t.prev=n.prev):this.first=t,null!=n.next?(n.next.prev=t,t.next=n.next):this.last=t},remove:function(n){null!=n.prev?n.prev.next=n.next:this.first=n.next,null!=n.next?n.next.prev=n.prev:this.last=n.prev}};var e=function(n){this.countField=0,this.entryList=new r,this.buckets={},this.compareSelector=null==n?u.Identity:n};return e.prototype={add:function(r,u){var e=this.compareSelector(r),o=t(e),s=new i(r,u);if(n(this.buckets,o)){const n=this.buckets[o];for(let t=0;t<n.length;t++)if(this.compareSelector(n[t].key)===e)return this.entryList.replace(n[t],s),void(n[t]=s);n.push(s)}else this.buckets[o]=[s];this.countField++,this.entryList.addLast(s)},get:function(i){var r=this.compareSelector(i),u=t(r);if(n(this.buckets,u)){var e=this.buckets[u];for(let n=0;n<e.length;n++){const t=e[n];if(this.compareSelector(t.key)===r)return t.value}}},set:function(r,u){var e=this.compareSelector(r),o=t(e);if(n(this.buckets,o)){const n=this.buckets[o];for(let t=0;t<n.length;t++)if(this.compareSelector(n[t].key)===e){const e=new i(r,u);return this.entryList.replace(n[t],e),n[t]=e,!0}}return!1},contains:function(i){var r=this.compareSelector(i),u=t(r);if(!n(this.buckets,u))return!1;var e=this.buckets[u];for(let n=0;n<e.length;n++)if(this.compareSelector(e[n].key)===r)return!0;return!1},clear:function(){this.countField=0,this.buckets={},this.entryList=new r},remove:function(i){var r=this.compareSelector(i),u=t(r);if(n(this.buckets,u)){var e=this.buckets[u];for(let n=0;n<e.length;n++)if(this.compareSelector(e[n].key)===r)return this.entryList.remove(e[n]),e.splice(n,1),0==e.length&&delete this.buckets[u],void this.countField--}},count:function(){return this.countField},toEnumerable:function(){var n=this;return new a((function(){var t;return new l((function(){t=n.entryList.first}),(function(){if(null!=t){const n={key:t.key,value:t.value};return t=t.next,this.yieldReturn(n)}return!1}),u.Blank)}))}},e}(),p=function(n){this.count=function(){return n.count()},this.get=function(t){return a.from(n.get(t))},this.contains=function(t){return n.contains(t)},this.toEnumerable=function(){return n.toEnumerable().select((function(n){return new x(n.key,n.value)}))}},x=function(n,t){this.key=function(){return n},g.call(this,t)};x.prototype=new g;class S{constructor(n){this.ratioOffset=0,this.merged=!1,Object.assign(this,n)}get label(){var n,t;return null!==(n=this._label)&&void 0!==n?n:null===(t=this.value)||void 0===t?void 0:t.label}set label(n){this._label=n}get fullData(){var n;return null===(n=this.axis)||void 0===n?void 0:n.data}get ratio(){var n,t,i;return(null===(n=this.data)||void 0===n?void 0:n.length)/(null!==(i=null===(t=this.fullData)||void 0===t?void 0:t.length)&&void 0!==i?i:0)}get mergedSegmentAdjustmentRatio(){var n,t;return null!==(t=null===(n=this.axis)||void 0===n?void 0:n.mergedSegmentAdjustmentRatio)&&void 0!==t?t:0}get adjustedRatio(){return this.merged?this.ratio-this.mergedSegmentAdjustmentRatio:this.ratio+this.mergedSegmentAdjustmentRatio*(this.ratio/(1-this.axis.mergedSegmentRatio))}get ratioRange(){return{start:this.ratioOffset,end:this.ratioOffset+this.adjustedRatio}}}class A{constructor(n,t){this._label=t,this.values=Array.isArray(n)?n:[n]}get label(){var n,t;return null!==(n=this._label)&&void 0!==n?n:null===(t=this.values)||void 0===t?void 0:t.toString()}match(n){return this.values.includes(n)}toString(){var n;return`[${null===(n=this.values)||void 0===n?void 0:n.toString()}]`}}class R{constructor(n){this.mergedSegmentAdjustmentRatio=0,Object.assign(this,n),this.generateSegments()}get label(){var n;return null!==(n=this._label)&&void 0!==n?n:this.dimension}set label(n){this._label=n}get segments(){return this._adjustedSegments}set segments(n){var t,i,r;if(this._segments=n,+this.maxSegmentCountLimit>0){const n=null===(t=this._segments)||void 0===t?void 0:t.slice(0,this.maxSegmentCountLimit-1),r=null===(i=this._segments)||void 0===i?void 0:i.slice(this.maxSegmentCountLimit-1),u=(null==r?void 0:r.length)>0&&new S({axis:this,value:new A(a.from(r).distinct((n=>n.value.values.toString())).selectMany((n=>n.value.values)).toArray()),data:r.flatMap((n=>n.data)),merged:!0,label:this.mergedSegmentLabel}),e=[...n];if(u){e.push(u);const n=u.ratio;n>this.mergedSegmentMaxRatioLimit&&(this.mergedSegmentAdjustmentRatio=n-this.mergedSegmentMaxRatioLimit)}this._adjustedSegments=e}else this._adjustedSegments=this._segments;let u=0;a.from(null!==(r=this._adjustedSegments)&&void 0!==r?r:[]).forEach((n=>{n.ratioOffset=u,u+=n.adjustedRatio}))}get data(){var n;return null===(n=this.parallelSets)||void 0===n?void 0:n.data}get mergedSegmentRatio(){var n,t,i;return null!==(i=null===(t=null===(n=this.segments)||void 0===n?void 0:n.find((n=>n.merged)))||void 0===t?void 0:t.ratio)&&void 0!==i?i:0}generateSegments(){var n;const t=a.from(null!==(n=this.data)&&void 0!==n?n:[]).groupBy((n=>n[this.dimension])).select((n=>new S({axis:this,value:new A(n.key()),data:n.toArray()}))).toArray();this.valueSortingFunction&&t.sort(((n,t)=>{var i,r,u,e;return this.valueSortingFunction(null===(r=null===(i=n.value)||void 0===i?void 0:i.values)||void 0===r?void 0:r[0],null===(e=null===(u=t.value)||void 0===u?void 0:u.values)||void 0===e?void 0:e[0])})),this.segments=t}}class ${constructor(n){Object.assign(this,n)}get valueHistory(){var n;return null===(n=this.axisSegments)||void 0===n?void 0:n.map((n=>n.value))}get currentAxisSegment(){var n;return null===(n=this.axisSegments)||void 0===n?void 0:n.at(-1)}get previousAxisSegment(){var n;return null===(n=this.axisSegments)||void 0===n?void 0:n.at(-2)}get fullData(){var n;return null===(n=this.parallelSets)||void 0===n?void 0:n.data}get segmentData(){var n,t,i;return null!==(t=null===(n=this.currentAxisSegment)||void 0===n?void 0:n.data)&&void 0!==t?t:null===(i=this.parallelSets)||void 0===i?void 0:i.data}get ratioInAxisSegment(){var n,t;return(null===(n=this.ratioRangeInAxisSegment)||void 0===n?void 0:n.end)-(null===(t=this.ratioRangeInAxisSegment)||void 0===t?void 0:t.start)}get ratio(){return this.ratioInAxisSegment*(this.currentAxisSegment?this.currentAxisSegment.ratio:1)}addSegmentToEnd(n){return this.axisSegments.push(n),this}addSegmentToBeginning(n){return this.axisSegments.unshift(n),this}updateRatioRangeInAxisSegment(n){return this.ratioRangeInAxisSegment=n,this}clone(){return new $({parallelSets:this.parallelSets,axisSegments:[...this.axisSegments],ratioRangeInAxisSegment:this.ratioRangeInAxisSegment,data:this.data})}equal(n){var t;return null===(t=this.axisSegments)||void 0===t?void 0:t.every(((t,i)=>{var r;return(null===(r=null==n?void 0:n.axisSegments)||void 0===r?void 0:r[i])===t}))}}class M{constructor(n){var t,i,r,u,e,o;this.depth=0,this.ratioOffsetInPreviousAxisSegment=0,Object.assign(this,n);const s=null===(t=this.parallelSets)||void 0===t?void 0:t.dimensions,f=null===(i=this.parallelSets)||void 0===i?void 0:i.dimensionAndAxisMap,c=(null===(u=null===(r=this.path)||void 0===r?void 0:r.axisSegments)||void 0===u?void 0:u.length)+1,l=c-1;if(l<(null==s?void 0:s.length)){const n=null==s?void 0:s[l],t=null==f?void 0:f.get(n);let i=null===(e=this.ratioRangeInNextAxisSegment)||void 0===e?void 0:e.start;this.children=a.from(null!==(o=null==t?void 0:t.segments)&&void 0!==o?o:[]).select((n=>{var t;const r=null===(t=this.axisSegmentAndRibbonPathMap)||void 0===t?void 0:t.get(n),u=a.from(null!=r?r:[]).where((t=>{var i,r;return(null===(r=null===(i=this.path)||void 0===i?void 0:i.axisSegments)||void 0===r?void 0:r.every(((n,i)=>{var r;return n===(null===(r=null==t?void 0:t.axisSegments)||void 0===r?void 0:r[i])})))&&t.currentAxisSegment===n})).firstOrDefault(),e=new M({parallelSets:this.parallelSets,axisSegmentAndRibbonPathMap:this.axisSegmentAndRibbonPathMap,path:u,parent:this,depth:c,ratioOffsetInPreviousAxisSegment:i});return i+=e.ratioInPreviousAxisSegment,e})).where((n=>{var t;return(null===(t=n.data)||void 0===t?void 0:t.length)>0})).toArray()}}get data(){var n;return null===(n=this.path)||void 0===n?void 0:n.data}get ratio(){var n;return null===(n=this.path)||void 0===n?void 0:n.ratio}get ratioInNextAxisSegment(){var n;return null===(n=this.path)||void 0===n?void 0:n.ratioInAxisSegment}get ratioRangeInNextAxisSegment(){var n;return null===(n=this.path)||void 0===n?void 0:n.ratioRangeInAxisSegment}get ratioInParentRibbon(){var n,t,i;return(null===(n=this.data)||void 0===n?void 0:n.length)/(null===(i=null===(t=this.parent)||void 0===t?void 0:t.data)||void 0===i?void 0:i.length)}get ratioInPreviousAxisSegment(){var n;return this.ratioInParentRibbon*(null===(n=this.parent)||void 0===n?void 0:n.ratioInNextAxisSegment)}get ratioRangeInPreviousAxisSegment(){return{start:this.ratioOffsetInPreviousAxisSegment,end:this.ratioOffsetInPreviousAxisSegment+this.ratioInPreviousAxisSegment}}}const E=class{constructor(t){n(this,t),this.AXIS_MARGIN=.1,this.dimensionAndAxisMap=void 0,this.ribbonTree=void 0,this.hostElementBoundingClientRect=void 0,this.data=void 0,this.dimensions=void 0,this.dimensionAndAxisLabelDict=void 0,this.dimensionAndAxisMaxSegmentCountLimitDict=void 0,this.dimensionAndAxisMergedSegmentLabelDict=void 0,this.dimensionAndAxisMergedSegmentMaxRatioDict=void 0,this.dimensionAndAxisValueSortingFunctionDict=void 0,this.ribbonTension=1}componentWillRender(){this.dimensionAndAxisMap=this.obtainDimensionAndAxisMap(),this.obtainRibbonTree()}componentDidLoad(){new ResizeObserver((n=>{for(const t of n)t.target===this.hostElement&&(this.hostElementBoundingClientRect=t.target.getBoundingClientRect())})).observe(this.hostElement)}componentShouldUpdate(n,t,i){["data","dimensions"].includes(i)&&(this.dimensionAndAxisMap=this.obtainDimensionAndAxisMap())}render(){return t(i,null,t("svg",{id:"main-svg"},this.renderVis()))}renderVis(){var n,t;return(null===(n=this.hostElementBoundingClientRect)||void 0===n?void 0:n.width)>0&&(null===(t=this.hostElementBoundingClientRect)||void 0===t?void 0:t.height)>0&&[this.renderRibbons(),this.renderAxes()]}renderAxes(){var n;return t("g",{class:"axes"},null===(n=this.dimensions)||void 0===n?void 0:n.map(((n,i)=>{const r=i/(this.dimensions.length-1)*(1-this.AXIS_MARGIN)+this.AXIS_MARGIN/2,u=this.dimensionAndAxisMap.get(n),e=u.segments,o=.05/e.length;return t("g",{class:"axis"},e.map((n=>{const i=o/2,e=this.obtainAxisSegmentRatioRangeWithAbsoluteMargins(n.ratioRange,[i,i]);return t("g",{class:"axis-segment"},t("rect",{class:"axis-segment-box",x:this.ratioToPixel(r,this.hostElementBoundingClientRect.width),y:this.ratioToPixel(e.start,this.hostElementBoundingClientRect.height),width:"15px",height:this.ratioToPixel(e.end-e.start,this.hostElementBoundingClientRect.height),fill:"black"},t("title",null,`${u.label}: ${n.label} (${this.ratioToPercentageString(n.ratio)})`)),t("line",{class:"axis-segment-line",x1:this.ratioToPixel(r,this.hostElementBoundingClientRect.width),y1:this.ratioToPixel(e.start,this.hostElementBoundingClientRect.height),x2:this.ratioToPixel(r,this.hostElementBoundingClientRect.width),y2:this.ratioToPixel(e.end,this.hostElementBoundingClientRect.height),stroke:"black"}))})))})))}renderRibbons(){return t("g",{class:"ribbons"},a.from(this.ribbonTree.children).traverseBreadthFirst((n=>{var t;return a.from(null!==(t=n.children)&&void 0!==t?t:[])})).where((n=>n.depth>1)).select((n=>{var i,r,u,e,o,s,f,c,l;const h=n.depth-2,a=null===(i=n.path)||void 0===i?void 0:i.previousAxisSegment,v=.05/(null===(u=null===(r=null==a?void 0:a.axis)||void 0===r?void 0:r.segments)||void 0===u?void 0:u.length)/2,d=this.obtainAxisSegmentRatioRangeWithAbsoluteMargins(null==a?void 0:a.ratioRange,[v,v]),w=n.ratioRangeInPreviousAxisSegment,g=this.obtainAxisSegmentRatioRangeWithRelativeMargins(d,[w.start,1-w.end]),y=null===(e=n.path)||void 0===e?void 0:e.currentAxisSegment,m=.05/(null===(s=null===(o=null==y?void 0:y.axis)||void 0===o?void 0:o.segments)||void 0===s?void 0:s.length)/2,b=this.obtainAxisSegmentRatioRangeWithAbsoluteMargins(null==y?void 0:y.ratioRange,[m,m]),p=n.ratioRangeInNextAxisSegment,x=this.obtainAxisSegmentRatioRangeWithRelativeMargins(b,[p.start,1-p.end]),S=(h+1)/(this.dimensions.length-1)*(1-this.AXIS_MARGIN)+this.AXIS_MARGIN/2,A=this.obtainRibbonPathD({x:this.ratioToPixel(h/(this.dimensions.length-1)*(1-this.AXIS_MARGIN)+this.AXIS_MARGIN/2,this.hostElementBoundingClientRect.width),y1:this.ratioToPixel(g.start,this.hostElementBoundingClientRect.height),y2:this.ratioToPixel(g.end,this.hostElementBoundingClientRect.height),childX:this.ratioToPixel(S,this.hostElementBoundingClientRect.width),childY1:this.ratioToPixel(x.start,this.hostElementBoundingClientRect.height),childY2:this.ratioToPixel(x.end,this.hostElementBoundingClientRect.height)});return t("path",{class:"ribbon",d:A,fill:"rgb(0,0,0,0.1)"},t("title",null,(null===(l=null===(c=null===(f=n.path)||void 0===f?void 0:f.axisSegments)||void 0===c?void 0:c.map((n=>n.label)))||void 0===l?void 0:l.join(", "))+` (${this.ratioToPercentageString(n.ratio)})`))})).toArray())}obtainDimensionAndAxisMap(){var n;const t=a.from(null!==(n=this.dimensions)&&void 0!==n?n:[]).select((n=>[n,new R({parallelSets:this,dimension:n,label:this.obtainAxisConfigDictValue(n,this.dimensionAndAxisLabelDict),maxSegmentCountLimit:this.obtainAxisConfigDictValue(n,this.dimensionAndAxisMaxSegmentCountLimitDict),mergedSegmentLabel:this.obtainAxisConfigDictValue(n,this.dimensionAndAxisMergedSegmentLabelDict),mergedSegmentMaxRatioLimit:this.obtainAxisConfigDictValue(n,this.dimensionAndAxisMergedSegmentMaxRatioDict),valueSortingFunction:this.obtainAxisConfigDictValue(n,this.dimensionAndAxisValueSortingFunctionDict)})])).toArray();return new Map(t)}obtainRibbonTree(){const n=this.obtainAxisSegmentAndValueSetMap();this.ribbonTree=new M({parallelSets:this,axisSegmentAndRibbonPathMap:n,path:new $({parallelSets:this,axisSegments:[],ratioRangeInAxisSegment:{start:0,end:1},data:this.data})})}obtainAxisSegmentAndValueSetMap(){var n;const t=n=>{var t;return a.from(null!==(t=null==n?void 0:n.axisSegments)&&void 0!==t?t:[]).takeExceptLast().aggregate(1,((n,t)=>n*(null==t?void 0:t.ratio)))},i=a.from(null!==(n=this.dimensions)&&void 0!==n?n:[]).selectMany(((n,i)=>{var r,u;const e=a.from(this.dimensions).take(i).select((n=>{var t;return null===(t=this.dimensionAndAxisMap)||void 0===t?void 0:t.get(n)})).toArray(),o=null===(r=this.dimensionAndAxisMap)||void 0===r?void 0:r.get(n);return a.from(null!==(u=null==o?void 0:o.segments)&&void 0!==u?u:[]).select((n=>{let i=[];if(e.length<1){const t=new $({parallelSets:this,axisSegments:[n],ratioRangeInAxisSegment:{start:0,end:1},data:null==n?void 0:n.data});i.push(t)}else a.from(e).reverse().forEach((r=>{var u;let e=0;i=a.from(null!==(u=null==r?void 0:r.segments)&&void 0!==u?u:[]).selectMany((r=>{var u;if((null==i?void 0:i.length)>0)return a.from(i).select((n=>{var i;const u=null==n?void 0:n.clone().addSegmentToBeginning(r);return u.data=a.from(null!==(i=null==u?void 0:u.data)&&void 0!==i?i:[]).where((n=>{var t,i;return null===(t=null==r?void 0:r.value)||void 0===t?void 0:t.match(n[null===(i=null==r?void 0:r.axis)||void 0===i?void 0:i.dimension])})).toArray(),u.updateRatioRangeInAxisSegment({start:e,end:e+=t(u)}),u}));{const i=new $({parallelSets:this,axisSegments:[r,n],data:a.from(null!==(u=null==n?void 0:n.data)&&void 0!==u?u:[]).where((n=>{var t,i;return null===(t=null==r?void 0:r.value)||void 0===t?void 0:t.match(n[null===(i=null==r?void 0:r.axis)||void 0===i?void 0:i.dimension])})).toArray()});return i.updateRatioRangeInAxisSegment({start:e,end:e+=t(i)}),a.from([i])}})).toArray()}));return[n,i]}))})).toArray();return new Map(i)}obtainAxisConfigDictValue(n,t){var i;return null!==(i=null==t?void 0:t[n])&&void 0!==i?i:null==t?void 0:t[""]}ratioToPercentageString(n,t=2){return`${(100*n).toFixed(t)}%`}ratioToPixel(n,t){return t*n}obtainRibbonPathD(n){const{x:t,y1:i,y2:r,childX:u,childY1:e,childY2:o}=n,s=this.ribbonTension*t+(1-this.ribbonTension)*u,f=this.ribbonTension*u+(1-this.ribbonTension)*t;let c=`M${t},${i}`;return c+=`L${t},${r}`,c+=`C${s},${r},${f},${o},${u},${o}`,c+=`L${u},${e}`,c+=`C${f},${e},${s},${i},${t},${i}`,c+="Z",c}obtainAxisSegmentRatioRangeWithAbsoluteMargins(n,t){return{start:n.start+(null==t?void 0:t[0]),end:n.end-(null==t?void 0:t[1])}}obtainAxisSegmentRatioRangeWithRelativeMargins(n,t){const i=n.end-n.start;return{start:n.start+(null==t?void 0:t[0])*i,end:n.end-(null==t?void 0:t[1])*i}}get hostElement(){return r(this)}};E.style=":host{display:block;height:100%;width:100%}#main-svg{height:100%;width:100%}.axis-segment-line{stroke-width:3px}.axis-segment-box{cursor:pointer;opacity:0;transition:opacity 0.3s}.axis-segment-box:hover{opacity:0.1}.ribbon{cursor:pointer}";export{E as hey_parallel_sets}